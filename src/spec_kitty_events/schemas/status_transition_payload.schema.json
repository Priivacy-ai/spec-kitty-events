{
  "$defs": {
    "DoneEvidence": {
      "description": "Evidence bundle required when a WP transitions to DONE.",
      "properties": {
        "repos": {
          "description": "At least one repo with changes",
          "items": {
            "$ref": "#/$defs/RepoEvidence"
          },
          "minItems": 1,
          "title": "Repos",
          "type": "array"
        },
        "review": {
          "$ref": "#/$defs/ReviewVerdict",
          "description": "Review verdict"
        },
        "verification": {
          "description": "Verification steps executed",
          "items": {
            "$ref": "#/$defs/VerificationEntry"
          },
          "title": "Verification",
          "type": "array"
        }
      },
      "required": [
        "repos",
        "review"
      ],
      "title": "DoneEvidence",
      "type": "object"
    },
    "ExecutionMode": {
      "description": "How a work-package is being executed.",
      "enum": [
        "worktree",
        "direct_repo"
      ],
      "title": "ExecutionMode",
      "type": "string"
    },
    "Lane": {
      "description": "Work-package lifecycle lanes.",
      "enum": [
        "planned",
        "claimed",
        "in_progress",
        "for_review",
        "done",
        "blocked",
        "canceled"
      ],
      "title": "Lane",
      "type": "string"
    },
    "RepoEvidence": {
      "description": "Evidence of repository changes for a completed work-package.",
      "properties": {
        "branch": {
          "description": "Branch name",
          "minLength": 1,
          "title": "Branch",
          "type": "string"
        },
        "commit": {
          "description": "Commit SHA or reference",
          "minLength": 1,
          "title": "Commit",
          "type": "string"
        },
        "files_touched": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "List of files modified",
          "title": "Files Touched"
        },
        "repo": {
          "description": "Repository identifier",
          "minLength": 1,
          "title": "Repo",
          "type": "string"
        }
      },
      "required": [
        "repo",
        "branch",
        "commit"
      ],
      "title": "RepoEvidence",
      "type": "object"
    },
    "ReviewVerdict": {
      "description": "Verdict from a human or automated reviewer.",
      "properties": {
        "reference": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "URL or reference for the review",
          "title": "Reference"
        },
        "reviewer": {
          "description": "Who reviewed",
          "minLength": 1,
          "title": "Reviewer",
          "type": "string"
        },
        "verdict": {
          "description": "Verdict string",
          "minLength": 1,
          "title": "Verdict",
          "type": "string"
        }
      },
      "required": [
        "reviewer",
        "verdict"
      ],
      "title": "ReviewVerdict",
      "type": "object"
    },
    "VerificationEntry": {
      "description": "A single verification step (e.g. test run, lint check).",
      "properties": {
        "command": {
          "description": "Command that was executed",
          "minLength": 1,
          "title": "Command",
          "type": "string"
        },
        "result": {
          "description": "Outcome of the command",
          "minLength": 1,
          "title": "Result",
          "type": "string"
        },
        "summary": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Human-readable summary",
          "title": "Summary"
        }
      },
      "required": [
        "command",
        "result"
      ],
      "title": "VerificationEntry",
      "type": "object"
    }
  },
  "$id": "spec-kitty-events/status_transition_payload",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "description": "Payload for a WPStatusChanged event describing a lane transition.",
  "properties": {
    "actor": {
      "description": "Who initiated the transition",
      "minLength": 1,
      "title": "Actor",
      "type": "string"
    },
    "evidence": {
      "anyOf": [
        {
          "$ref": "#/$defs/DoneEvidence"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "Evidence bundle (required when to_lane=DONE)"
    },
    "execution_mode": {
      "$ref": "#/$defs/ExecutionMode",
      "description": "How the work-package is being executed"
    },
    "feature_slug": {
      "description": "Feature identifier",
      "minLength": 1,
      "title": "Feature Slug",
      "type": "string"
    },
    "force": {
      "default": false,
      "description": "Whether this is a forced transition",
      "title": "Force",
      "type": "boolean"
    },
    "from_lane": {
      "anyOf": [
        {
          "$ref": "#/$defs/Lane"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "Lane the WP is transitioning from (None for initial)"
    },
    "reason": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "Reason for the transition (required when force=True)",
      "title": "Reason"
    },
    "review_ref": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "Reference to an external review",
      "title": "Review Ref"
    },
    "to_lane": {
      "$ref": "#/$defs/Lane",
      "description": "Lane the WP is transitioning to"
    },
    "wp_id": {
      "description": "Work-package identifier",
      "minLength": 1,
      "title": "Wp Id",
      "type": "string"
    }
  },
  "required": [
    "feature_slug",
    "wp_id",
    "to_lane",
    "actor",
    "execution_mode"
  ],
  "title": "StatusTransitionPayload",
  "type": "object"
}
